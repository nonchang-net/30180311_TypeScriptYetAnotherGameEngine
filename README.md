# YAGE - Yet Another Game Engine

## 概要

- ゲームのルールエンジン設計プロジェクト。
	- Yet Anotherとあるけど、何かの代替になるようなものを目指しているわけでもない。
	- TypeScriptで簡単なゲームアイデアを実装する際に、ゲームイベントやコンテキスト、メッセージベース処理なんかのテンプレートを作っておきたい……という構想。
	- 「TypeScript+three.jsによる基本プロジェクト」を元に、three.jsを省いて構築。


## ライセンスとか

個人の練習用リポジトリなので転載などはご容赦ください。  
なんか有益なものができたらMIT記載でリポジトリ分けます。


## 実行

npm run dev


## 目標

- メッセージベースのゲームルール評価設計のテンプレート作成

	- まずはProof of Concept。

- ドラクエ風のバトルシステムからモンハンタイプのスキルルールまで、複雑なゲーム設計に耐える、極力汎用化した方法論を検討していく……
	- 理想をぶち上げたけど、とりあえず単純なターンベースバトルゲームをメッセージベースで今風に作ったらどうなるかから見ていく。

## やること

- `実際に自分のゲームで使うときは、git submoduleとして取り込む`形を想定。
	- [Git submodule の基礎](https://qiita.com/sotarok/items/0d525e568a6088f6f6bb)


## 設計メモ

### (Game)Context

- HP、空腹度、所持アイテム、現在のフロア、座標……。
- 何もメソッドを持たなくて良いかも。
- シリアライズできることが要求される。


### ApplicableContext

- xxxContext.Apply()を提供するインターフェース。
- contextAにcontextBをapplyすると、新しい値で上書きして値の変更イベントを飛ばす、という処理を検討。
- XxxxContext自体は「特にインターフェースを持たない自由なクラス」として良さそうなので分ける。


### (不要？) GameEvalutor

- おそらく……なんだけど、GameEvalutor（評価器）は必要ない。これはmain関数に当たるものだ。
- 抽象化が徹底できたときにどうなるかを見てから検討。
	- 評価器は一つのforループで完了するようなものをイメージしている。


### Rule(IRule/IRuleParent)

- Contextと引数を受け取って、ApplicableContextを返す、IRuleまたはIRuleParentインターフェースを実装した多彩なRuleクラスがある。
- modifierである。
	- 変更結果を返すのみで、自分自身は破壊的な変更は行わない。
	- newするコストが多量に発生するが、この問題については一旦考慮から外す。効率に寄せて破壊ForceAppicableContextなどを用意しても良いだろう。
- IRuleインターフェースを実装したRuleクラスが無数にある。
- IRuleParent。これはIRuleを継承し、さらにIRuleのリストを子として持つ。自身の評価の際に、子要素も評価する。


### GameEvent

- あらゆる状況変化はメッセージとして飛び交う。以下はその例。
	- タイトルが表示された。
	- タイトル画面でタップされた。
	- 一歩歩いた。
	- 空腹度が下がった。
	- ダメージを受けた。
	- 歩いて毒のダメージを受けた。
	- 全滅した。
- イベントは、IEventを継承し、コンストラクタに引数があったりなかったりする**だけのもの**だ。
	- 検討: TypeScriptではES Eventを使うべきだろうか？
		- しかしパブリングとかいらんしなぁ。
	- 20180310:
		- とりあえずは、イベント処理モジュールを自作してみた。
		- ボイラープレートコードがあるので理想的ではない感じではあるけど、ゲームイベント定義と実装を切り分けるサンプルにはなったと思う。


### (仮) UIManager

- これの設計は一旦適当でよしとする。上記のイベントモデルの検討とは別。アプリのデモ部分に過ぎないので。
- 以下の仕事をさせることになる。
	- HTMLElementにイベントを登録する。
	- UIと値のバインディングは一旦念頭から除外。
	- イベントを受け取ってHTMLElementなどを更新する。






## 日別ログ

### 20180309金曜日

- 22:11
	- 簡単なゲームを設計するにあたり、自分なりのゲームの設計テンプレートが固まっていないのでTypeScriptでテンプレートを作ろうと考えた。
	- 可能な限り疎結合、プランナーの多彩な要求をまるっと包み込めるような汎用性のある「シンプルな」設計を目指す。
	- とりあえずガワ作成。

### 20180310土曜日

- 14:45
	- 今日は初期コミットまでを目標にしたい。どこを目標にするかな。
		- 仮目標としては「Rule評価までが想定した状態で動くこと」かなぁ。
	- GameEngineとしての部分と、SampleGameとしての実装を分けておこう。
	- DOM Eventに頼らない簡単なイベントを定義しよう。
		- まず参考探す。
			- https://gist.github.com/mindplay-dk/6665405
			- なんか文字列依存……？まあ、シンプルか。
		- できるべきことは、
			- subscribe(this,XxxEvent,(event)=>{xxx})
			- unsubscribeAll(this)
				- thisを渡して、自分が登録した
			- broadcast
				- IEvent実装クラスXxxEventを渡すと、そのXxxEventを購読した全てのlambdaを実行する。

- 18:55
	- 酒飲んでるからでもあるけど、ものすごく時間かかった。

- 00:00
	- 多分**もっとうまくやれる**という不安を抱えながらの作業。
	- ただ、message drivenなコードが書ける基盤にはなったと思う。一旦ここまでをコミットしておこう。first commit。



`EOF`